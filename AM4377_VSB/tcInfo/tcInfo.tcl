# tcInfo.tcl - generated by tcInfoGen.tcl


package require Wind 1.1

set tcWIND_HOME [file normalize [prjEnv WIND_HOME]]

set tcWIND_HOST_TYPE [prjEnv WIND_HOST_TYPE]

if {$tcWIND_HOST_TYPE == "x86-win32"} {
# this will be the WIN subst
set tct1 /WIN32/bin
set tct2 /x86-win32/bin
} else {
# this will be the LINUX subst
set tct1 /LINUX386/bin
set tct2 /x86-linux2/bin
}


# toolchain : ARMARCH7diab
# toolchain : ARMARCH7gnu

namespace eval tcInfo {}

lappend tcInfo::ToolFamilies(ARMARCH7) diab
set tcInfo_ARMARCH7diab(TOOL_FAMILY) diab
set ::tcInfo_ARMARCH7diab(CC) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dcc"
set ::tcInfo_ARMARCH7diab(CPP) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dcc -E"
set ::tcInfo_ARMARCH7diab(AS) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dcc"
set ::tcInfo_ARMARCH7diab(LD) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dld"
set ::tcInfo_ARMARCH7diab(NM) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/ddump -Ng -g"
set ::tcInfo_ARMARCH7diab(SIZE) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/ddump -Z"
set ::tcInfo_ARMARCH7diab(AR) "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dar"
set ::tcInfo_ARMARCH7diab(HEX_FLAGS) ""
set ::tcInfo_ARMARCH7diab(OPTION_INCLUDE_DIR) -I
set ::tcInfo_ARMARCH7diab(OPTION_DEFINE_MACRO) -D
set ::tcInfo_ARMARCH7diab(OPTION_UNDEFINE_MACRO) -U
set ::tcInfo_ARMARCH7diab(OPTION_LANG_C) "-xc"
set ::tcInfo_ARMARCH7diab(OPTION_GENERATE_DEPENDENCY_FILE) -MD
set ::tcInfo_ARMARCH7diab(OPTION_DEPEND) "-Xmake-dependency -w"
set ::tcInfo_ARMARCH7diab(CC_ARCH_SPEC) "-tARMCORTEXA9MV:vxworks7"
namespace eval ::tc_ARMARCH7diab { }

set ::tc_ARMARCH7diab::tcname(little_vector) diab

namespace eval ::tc_ARMARCH7diab::tool_cc {

    proc type {} {
	return "C/C++ compiler"
    }

    proc inputSuffixes {} {
	return ".c .cxx .cpp .cc .C .CPP"
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	return [list "\$(CC) $flags -c $file"]
    }

    proc toolMacro {} {
	return CC
    }

    proc flagsMacro {} {
	return CFLAGS
    }

    proc sdFlagsMacro {} {
	return CC_SDA_FLAGS
    }
}

namespace eval ::tc_ARMARCH7diab::tool_as {

    proc type {} {
	return assembler
    }

    proc inputSuffixes {} {
	return ".s"
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	set tc [namespace parent]
	if {[${tc}::asmHasCpp]} {
	    return [list "\$(CC) $flags -c $file -o [outputFiles $file]"]
	}
	global tcInfo_[${tc}::name]
	regsub -all -- " -MD" $flags "" cppFlags
	set tmpFile [file rootname $file]_tmp.s
	return [list "\$(CPP) $cppFlags $file > ${tmpFile}" "\$(CC) $flags -c ${tmpFile} -o [outputFiles $file]" "\$(RM) ${tmpFile}"]
    }

    proc toolMacro {} {
	return CC
    }

    proc flagsMacro {} {
	return CFLAGS_AS
    }
    proc sdFlagsMacro {} {
	return 
    }
}

namespace eval ::tc_ARMARCH7diab::tool_ld {

    proc type {} {
	return "linker"
    }

    proc inputSuffixes {} {
	return ""
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	return [list "${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dld $flags -c $file"]
    }

    proc toolMacro {} {
	return LD
    }

    proc flagsMacro {} {
	return LDFLAGS
    }
}

namespace eval ::tc_ARMARCH7diab {

    proc type {} {
	return C++
    }

    proc tool {} {
	return diab
    }

    proc family {} {
	return diab
    }

    proc cpu {} {
	return ARMARCH7
    }

    proc archDir {} {
	return arm
    }

    proc name {} {
	return ARMARCH7diab
    }

    proc toolListGet {} {
	return [namespace children [namespace current] tool_*]
    }

    proc toolFindByFile {file} {
	foreach tool [toolListGet] {
	    if {[lsearch [${tool}::inputSuffixes] [file extension $file]] != -1} {
		return $tool
	    }
	}
	prjWarnLog "no tool works on file $file"
	return ""
    }

    proc toolFindByType {type} {
	foreach tool [toolListGet] {
	    if {[${tool}::type] == $type} {
		return $tool
	    }
	}
	prjWarnLog "no tool of type $type"
	return ""
    }

    proc dependFiles {tool flags file} {
	regsub -all -- " -MD" $flags "" cppFlags
	if {[catch {set bUseQuickScan [::Dependencies::UseQuickScan?]}] || !$bUseQuickScan || [catch {set result [DependencyAnalyzer::GenerateDependenciesFromFile $cppFlags $file]}]} {
	    set result [oldDependFiles $tool $flags $file]
	}
	return $result
    }

    proc oldDependFiles {tool flags file} {

	global tcInfo_[name]

	regsub -all -- " -MD" $flags "" cppFlags
	set errorFile [tempFileGet]
	if {[catch {eval exec ${tcWIND_HOME}/compilers/diab-5.9.6.1${tct1}/dcc -E -Xmake-dependency -w $cppFlags $file 2>  [filenameQuoteIfNecessary $errorFile]} depend]} {
	    set fd [open $errorFile r]
	    set dependError [read $fd]
	    close $fd
	    error "dependency generation failed: $dependError"
	}
	file delete $errorFile
	regsub -all { \\} $depend {} depend
	regsub -all {\\} $depend {\/} depend
	return [lrange $depend 2 end]
    }

    proc macroListGet {} {
	global tcInfo_[name]
	return [array names tcInfo_[name]]
    }

    proc macroDefaultValGet {macro} {
	global tcInfo_[name]
	return [set tcInfo_[name]($macro)]
    }

    proc commSymLink {} {
	switch -glob [archDir] {
	    mc68k {return symbol}
	    default {return module}
	}
    }

    proc defaultWtxDownloadFlags {strFilename} {
	set bufNmOutput {}
	regsub -- -g [macroDefaultValGet NM] {} strCmd
	set bFailed [catch {set bufNmOutput "\n[eval exec $strCmd $strFilename ]" } ]
	if {$bFailed || [regexp "\n0+\[ \t]+\[A-Za-z]\[ \t]+___gnu_compiled_cplusplus" $bufNmOutput] } {
	    return {LOAD_GLOBAL_SYMBOLS|LOAD_COMMON_MATCH_ALL}
	} else {
	    return {LOAD_GLOBAL_SYMBOLS|LOAD_COMMON_MATCH_NONE}
	}
    }

    proc asmHasCpp {} {
	return 1
    }

    proc endian {} {
	return little
    }

    proc fp {} {
	return vector
    }

    proc dm {} {
	return [list ILP32 ]
    }

    proc default_VSB {} {
	return arm/ARMARCH7
    }

}

if {[info commands prjTcAdd] == "prjTcAdd"} {
    prjTcAdd ::tc_ARMARCH7diab
}

lappend tcInfo::ToolFamilies(ARMARCH7) gnu
set tcInfo_ARMARCH7gnu(TOOL_FAMILY) gnu
set ::tcInfo_ARMARCH7gnu(CC) "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ccarm"
set ::tcInfo_ARMARCH7gnu(CPP) "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ccarm -E"
set ::tcInfo_ARMARCH7gnu(AS) "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ccarm"
set ::tcInfo_ARMARCH7gnu(LD) "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ldarm"
set ::tcInfo_ARMARCH7gnu(NM) "nmarm -g"
set ::tcInfo_ARMARCH7gnu(SIZE) "sizearm"
set ::tcInfo_ARMARCH7gnu(AR) "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ararm"
set ::tcInfo_ARMARCH7gnu(HEX_FLAGS) ""
set ::tcInfo_ARMARCH7gnu(OPTION_INCLUDE_DIR) -I
set ::tcInfo_ARMARCH7gnu(OPTION_DEFINE_MACRO) -D
set ::tcInfo_ARMARCH7gnu(OPTION_UNDEFINE_MACRO) -U
set ::tcInfo_ARMARCH7gnu(OPTION_LANG_C) "-x assembler-with-cpp"
set ::tcInfo_ARMARCH7gnu(OPTION_GENERATE_DEPENDENCY_FILE) -MD
set ::tcInfo_ARMARCH7gnu(OPTION_DEPEND) "-M -w"
set ::tcInfo_ARMARCH7gnu(CC_ARCH_SPEC) "-t7 -mfpu=vfp -mfloat-abi=softfp"
namespace eval ::tc_ARMARCH7gnu { }

set ::tc_ARMARCH7gnu::tcname(little_vector) gnu

namespace eval ::tc_ARMARCH7gnu::tool_cc {

    proc type {} {
	return "C/C++ compiler"
    }

    proc inputSuffixes {} {
	return ".c .cxx .cpp .cc .C .CPP"
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	return [list "\$(CC) $flags -c $file"]
    }

    proc toolMacro {} {
	return CC
    }

    proc flagsMacro {} {
	return CFLAGS
    }

    proc sdFlagsMacro {} {
	return CC_SDA_FLAGS
    }
}

namespace eval ::tc_ARMARCH7gnu::tool_as {

    proc type {} {
	return assembler
    }

    proc inputSuffixes {} {
	return ".s"
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	set tc [namespace parent]
	if {[${tc}::asmHasCpp]} {
	    return [list "\$(CC) $flags -c $file -o [outputFiles $file]"]
	}
	global tcInfo_[${tc}::name]
	regsub -all -- " -MD" $flags "" cppFlags
	set tmpFile [file rootname $file]_tmp.s
	return [list "\$(CPP) $cppFlags $file > ${tmpFile}" "\$(CC) $flags -c ${tmpFile} -o [outputFiles $file]" "\$(RM) ${tmpFile}"]
    }

    proc toolMacro {} {
	return CC
    }

    proc flagsMacro {} {
	return CFLAGS_AS
    }
    proc sdFlagsMacro {} {
	return 
    }
}

namespace eval ::tc_ARMARCH7gnu::tool_ld {

    proc type {} {
	return "linker"
    }

    proc inputSuffixes {} {
	return ""
    }

    proc outputFiles {inFile} {
	return [file rootname [file tail $inFile]].o
    }

    proc buildCmds {flags file} {
	return [list "${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ldarm $flags -c $file"]
    }

    proc toolMacro {} {
	return LD
    }

    proc flagsMacro {} {
	return LDFLAGS
    }
}

namespace eval ::tc_ARMARCH7gnu {

    proc type {} {
	return C++
    }

    proc tool {} {
	return gnu
    }

    proc family {} {
	return gnu
    }

    proc cpu {} {
	return ARMARCH7
    }

    proc archDir {} {
	return arm
    }

    proc name {} {
	return ARMARCH7gnu
    }

    proc toolListGet {} {
	return [namespace children [namespace current] tool_*]
    }

    proc toolFindByFile {file} {
	foreach tool [toolListGet] {
	    if {[lsearch [${tool}::inputSuffixes] [file extension $file]] != -1} {
		return $tool
	    }
	}
	prjWarnLog "no tool works on file $file"
	return ""
    }

    proc toolFindByType {type} {
	foreach tool [toolListGet] {
	    if {[${tool}::type] == $type} {
		return $tool
	    }
	}
	prjWarnLog "no tool of type $type"
	return ""
    }

    proc dependFiles {tool flags file} {
	regsub -all -- " -MD" $flags "" cppFlags
	if {[catch {set bUseQuickScan [::Dependencies::UseQuickScan?]}] || !$bUseQuickScan || [catch {set result [DependencyAnalyzer::GenerateDependenciesFromFile $cppFlags $file]}]} {
	    set result [oldDependFiles $tool $flags $file]
	}
	return $result
    }

    proc oldDependFiles {tool flags file} {

	global tcInfo_[name]

	regsub -all -- " -MD" $flags "" cppFlags
	set errorFile [tempFileGet]
	if {[catch {eval exec ${tcWIND_HOME}/compilers/gnu-4.8.1.9${tct2}/ccarm -E -M -w $cppFlags $file 2>  [filenameQuoteIfNecessary $errorFile]} depend]} {
	    set fd [open $errorFile r]
	    set dependError [read $fd]
	    close $fd
	    error "dependency generation failed: $dependError"
	}
	file delete $errorFile
	regsub -all { \\} $depend {} depend
	regsub -all {\\} $depend {\/} depend
	return [lrange $depend 2 end]
    }

    proc macroListGet {} {
	global tcInfo_[name]
	return [array names tcInfo_[name]]
    }

    proc macroDefaultValGet {macro} {
	global tcInfo_[name]
	return [set tcInfo_[name]($macro)]
    }

    proc commSymLink {} {
	switch -glob [archDir] {
	    mc68k {return symbol}
	    default {return module}
	}
    }

    proc defaultWtxDownloadFlags {strFilename} {
	set bufNmOutput {}
	regsub -- -g [macroDefaultValGet NM] {} strCmd
	set bFailed [catch {set bufNmOutput "\n[eval exec $strCmd $strFilename ]" } ]
	if {$bFailed || [regexp "\n0+\[ \t]+\[A-Za-z]\[ \t]+___gnu_compiled_cplusplus" $bufNmOutput] } {
	    return {LOAD_GLOBAL_SYMBOLS|LOAD_COMMON_MATCH_ALL}
	} else {
	    return {LOAD_GLOBAL_SYMBOLS|LOAD_COMMON_MATCH_NONE}
	}
    }

    proc asmHasCpp {} {
	return 1
    }

    proc endian {} {
	return little
    }

    proc fp {} {
	return vector
    }

    proc dm {} {
	return [list ILP32 ]
    }

    proc default_VSB {} {
	return arm/ARMARCH7
    }

}

if {[info commands prjTcAdd] == "prjTcAdd"} {
    prjTcAdd ::tc_ARMARCH7gnu
}
